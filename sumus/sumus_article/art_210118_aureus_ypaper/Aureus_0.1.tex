\documentclass[a4paper, 12pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[T2A]{fontenc}
\usepackage[english, russian]{babel} 
\usepackage{amscd, amsmath, amssymb, amsthm, enumerate, indentfirst, longtable, ifthen} %% addlibrary rom mathematic 
\usepackage{ragged2e}
\usepackage{microtype}
%кодировка шрифта в pdf
\usepackage{cmap}
%\usepackage{fontspec}
%\setmainfont[Ligatures=TeX]{Georgia}
%\setsansfont[Ligatures=TeX]{Arial}
\usepackage[most]{tcolorbox}
\usepackage{hyperref} %hyperlink support
\definecolor{black}{rgb}{0.0, 0.0, 0.0} 
\definecolor{lightyellow}{rgb}{1.0, 1.0, 0.87}
\pagecolor{black}
\color{lightyellow}
\usepackage{indentfirst}
\usepackage{setspace}
\setstretch{1.15} % interval 
 % \usepackage{multirow}
 % \usepackage{longtable} 
\RequirePackage{caption}
\DeclareCaptionLabelSeparator{defffis}{. }
\captionsetup{justification=centering,labelsep=defffis}
\usepackage{graphicx}
\graphicspath{{pictures/}}
\DeclareGraphicsExtensions{.png,}
 %%end picture 
%\linespread{1.3} % полуторный интервал
\usepackage{geometry}
\geometry{
 	tmargin=15mm,       % Up 
 	bmargin=15mm,      % Down 
 	lmargin=15mm,        % left поле
 	rmargin=15mm,        % right  
}
%%управление интервалами
\makeatletter
\renewcommand{\@listI}{%
	\topsep=0pt }
\makeatother
\makeatletter
\let\old@itemize=\itemize
\def\itemize{\old@itemize
	\setlength{\itemsep}{0pt}
	\setlength{\parskip}{0pt}
	\setlength{\leftskip}{10pt}
}
\makeatother
\makeatletter
\let\old@enumerate=\enumerate
\def\enumerate{\old@enumerate
	\setlength{\itemsep}{00pt}
	\setlength{\parskip}{0pt}
	\setlength{\leftskip}{0pt}
}\makeatother


%% new command 
\newcommand{\jj}{\righthyphenmin=20 \justifying}
%\renewcommand{\rmdefault}{ftm} % Times New Roman
%\renewcommand{\familydefault}{\sffamily}
%\renewcommand{\rmdefault}{cmr}
%\renewcommand{\rmdefault}{cmr}
%\renewcommand{\sfdefault}{cmss}
\renewcommand{\ttdefault}{cmtt}
\renewcommand{\rmdefault}{cmss}
\renewcommand{\ttdefault}{cmss}

\usepackage{float}
\usepackage{graphicx,xcolor} % графика для svg
\graphicspath{{fig/}}

%opening
\title{\Huge\textbf{AUREUS}\\
{Fast, free transaction and secure stable coin}}
\date{26 августа 2019 г.}

\begin{document}

\maketitle

\textbf{\Large{Tech Paper v.0.2}}

\author{Aureus Securities AG}

{Short version: www.swissaureus.com}

\section{Введение}\addcontentsline{toc}{section}{Введение}
...почему и зачем мы создаем блокчейн Aureus Securities AG ... 
Существующие сегодняшние цифровые валюты также не решают эти проблемы:
\begin{itemize}
	\item BTC децентрализованный, но слишком волатильный, медленный и стоимость транзакции постоянно растёт;
	\item Market Pegged Asset в BitShares привязаны к залогу в криптовалюте BTS, которая еще более нестабильна, чем BTC.
\end{itemize}

В сети со временем будут выпущены следующие базовые инструменты (USD, EUR, CNY  и т.п.) ...:

Обладание токеном AUG даст ... 

\textbf{Поэтому мы создали пространство со следующим набором свойств}

\begin{itemize} 
	\item Средства расчёта со стабильной ценой, привязанные  к XDR.
	\item Прозрачная эмиссия на основе open source, реализованного в коде алгоритма, имеющего математически строгое доказательство.
	\item Бесплатные транзакции.
	\item Быстрые транзакции, проходящие в течение одной минуты.
	\item Децентрализация, основанная на 10 000 узлов по всему миру, принадлежащих различным людям и организациям.
\end{itemize}

Этот инструмент позволит людям:

\begin{itemize}
	\item быть уверенным в сохранности своих ценностей;
	\item свободно, быстро, надёжно и без комиссий переносить ценность в любую точку мира.

\end{itemize}

\section{Описание платформы}
Финансовая платформа Aureus Securities AG создана на технологиях блокчейн-конструктора 
Gaus\footnote{Описание всех возможностей блокчейн-конструктора Gaus не является целью данного документа.}.
Проектно-зависимая часть блокчейна была разработана совместно со специалистами Gaus.
Основные возможности блокчейн-сети Aureus Securities AG:
\begin{itemize}
	\item Используется алгоритм консенсуса sdBFT\footnote{Алгоритм семейства POS блокчейнов};
	\item Количество узлов участвующих в формировании блока - 5;
	\item Блок в блокчейне формируется каждые 20 секунд;
	\item Количество узлов в сети на начало старта 50;
	\item Выполнение привилегированных операций в сети осуществляется через multisign кошельки уполномоченными лицами;
	\item Через привилегированные операции производится добавление/исключение узлов из блокчейн-сети, регистрация новых токенов, дополнительная эмиссия токенов;
	\item Multisign кошельки для пользователей блокчейна;
	\item Автоматическое усечение блокчейна (на семилетнем интервале);
	\item Скоростные характеристики блокчейна: включение в блок транзакций ~ до 10 000 в секунду (при обеспечении надлежащих каналов вязи и достаточной производительности узлов блокчейн сети).
\end{itemize}


\section{Алгоритм эмиссии}

В платформе Aureus Securities AG создаются токены, которые используются для расчётов. Основной токен системы AUS равен по стоимости 1 USD.
Эмиссия токенов осуществляется с помощью специальной multisign транзакцией, которая должна быть последовательно подписана уполномоченными лицами (кошельками имеющими специальный тэг Owner). Для того, чтобы блокчейн осуществил эмиссию должна быть выпущена и подписана транзакция `multi sign register token transaction` как минимум тремя уполномоченными лицами.
Уполномоченными лицами являются штатные сотрудники Aureus Securities AG.
Характеристики эмиссии:
\begin{itemize}
	\item Создаваемый токен имеет трёх буквенное обозначение и десятичный код. 
	\item Каждая дополнительная эмиссия эмитируется по прозрачному алгоритму.
	\item Количество разрядов целой части: 11.
	\item Количество разрядов после запятой: 2.
\end{itemize}

При запуске блокчейн-сети, в генезис блоке блокчейна не определены токены и их количество. Первичная эмиссия это создание токена AUS в количестве 1.

\subsection{Reflection point}

\begin{itemize}
	\item Благодаря нулевой комиссии за пересылку токенов, система позволяет совершать микротранзакции, поэтому для обеспечения длительного функционирования блокчейна вводится процедура его периодического усечения.
	\item При достижении размера блокчейна в 4 Tb включается алгоритм усечения: система условно удаляет из рабочей части блокчейна  все нулевые (пустые) кошельки и все кошельки, имеющие баланс менее 1 токена. Состояние блокчейна после очистки будет записано в новый Genesis Block. Предыдущее состояние блокчейна будет сохранено только на специализированных (архивных) узлах.
\end{itemize}

\section{Бесплатные быстрые транзакции}

Транзакции в сети Aureus Securities AG бесплатны, блок закрывается за 20 секунд, проектная пропускная способность - до 10 000 транзакций в секунду. Оптимизация блокчейна происходит за счет того, что мы не храним информацию о входе-выходе (в отличие от UTXO-модели в BTC-подобных системах).

Бесплатность транзакций для пользователей возможна благодаря механизму минтинга (см. раздел ''Эмиссия нодами при закрытии блока (minting)``) и функции Reflection point.

\section{Блокчейн}

\subsection{Обоснование выбора}
Цели применения блокчейна Aureus Securities AG потребовали консенсуса, отвечающего следующим характеристикам блокчейна.
\begin{enumerate}
				\item Время создания нового блока 20 секунд.
			\item Общее количество узлов, которые могут принять участие в выработке консенсуса, может меняться от $10^3$ до $10^4$.
			\item Высокая скорость транзакций – не менее $10^3$ транзакций в секунду.
			\item Реализация алгоритма блокчейна не должна требовать существенных вычислительных, по сравнению с блокчейнами PoW, мощностей.
\end{enumerate}
Выбор пал на алгоритм sdBFT, который  обладает более высоким быстродействием по сравнению с BFT алгоритмами. Потенциально большое число участников консенсуса усложняет предварительный сговор, когда группа голосующих узлов формирует новый блок, управляя составом блока по своему усмотрению, так как при следующем установлении консенсуса будет выбрано другое множество голосующих узлов. Псевдослучайный выбор множества голосующих узлов не позволит оказать существенного влияния на выбор узлов при следующем голосовании.
С описанием алгоритма можно ознакомиться в статье \href{magnet:?xt=urn:btih:c5a3d2762bd1f10c18f51b2606b1a32549d79ed4\&dn=Article\%20concensus\%20sdBFT.pdf\&tr=udp\%3A\%2F\%2Ftracker.leechers-paradise.org\%3A6969\&tr=udp\%3A\%2F\%2Ftracker.coppersurfer.tk\%3A6969}{Article concensus sdBFT}.

\subsection{Алгоритм формирования нового блока}

\begin{itemize}
	\item Пусть в некий момент времени пользователь формирует транзакцию $I$. 
	\item Транзакция передается ближайшей ноде, с которой связан данный клиент. 
	\item Нода может находиться в одном из трёх состояний: пассивная, эскорт или мастер. 
	\item Если нода пассивная, она проверяет транзакцию и передает ее далее по пиринговой сети, пока транзакция не дойдёт до эскорт-ноды. 
	\item Эскорт-нода пересылает транзакцию мастер-ноде. 
	\item Мастер-нода проверяет транзакцию и, если транзакция корректная, пересылает ее эскорт-нодам, а также записывает транзакцию $I$ в формируемый блок. 
	\item Эскорт-ноды, приняв транзакцию $I$, проверяют ее на корректность и записывают ее в формируемый блок. 
	\item Данная последовательность действий повторяется до момента завершения блока, не более 20 секунд. 
	\item После этого мастер-нода рассылает сообщение о завершении блока. 
	\item Каждая эскорт-нода рассчитывает хеш блока транзакций, электронную подпись хеша и пересылает полученный хеш мастер-ноде.
	\item Мастер-нода рассчитывает количество корректных, по ее мнению, электронных подписей. Если полученное число корректных подписей превышает 2/3 от общего значения эскорт-нод, участвующих в консенсусе,  блок считается сформированным. Иначе блок не формируется.
	\item Блокчейн находится вне времени, не проверяет и не согласовывает время транзакций, помещаемых в блок.
	\item Системы, работающие поверх блокчейна, будут ориентироваться на некое усредненное время закрытия блоков (около 20 секунд).
\end{itemize}

\subsection{Генератор псевдослучайных чисел }

Стандартные генераторы псевдослучайных чисел, встроенные в операционные системы, как правило, имеют ряд существенных уязвимостей, наиболее опасные из которых:

\begin{itemize}
	\item В качестве seed для создания псевдослучайного числа используется timestamp. В итоге, если злоумышленник знает алгоритм генерации псевдослучайного числа и примерное время его генерации, то он может с высокой вероятностью методом перебора подобрать приватный ключ (пароль), сгенерированный таким алгоритмом.
	\item Даже если помимо timestamp используются иные данные, стандартные генераторы псевдослучайных чисел генерируют довольно предсказуемые последовательности, что предоставляет злоумышленниками возможность подбора паролей (хешей) методом перебора.

\end{itemize}

\subsubsection{Криптография}

\begin{itemize}
	\item ECSDA Digital Signature algorithm (используется в BTC);
	\item Ed25519 scheme (быстрее , чем используемая BTC);
	\item SHA-3 алгоритм хэширования (быстрее и надежнее, чем в BTC);
	\item программный генератор случайных чисел, основан на двойном вычислении хеш функции с динамическим изменением начального состояния. Качество случайной последовательности, вырабатываемой генератором псевдослучайной последовательности, не хуже $0.5+D$ на бинарный знак при $|D| <0.01$, что удовлетворяет гипотезе о равномерном распределении анализируемой последовательности случайных чисел.
\end{itemize}

\subsubsection{Общие свойства блокчейна}

\begin{itemize}
	\item Поддержка микротранзакций (“заплатить за кофе”) благодаря нулевой комиссии.
	\item Максимальная сумма транзакции не ограничена.
	\item Блокчейн периодически производит само-оптимизацию и поддерживает свой размер в заданных границах.
	\item Кошельки с мусорным балансом обнуляются, а их содержимое поступает нодам, участвовавшим в усечении блокчейна.
\end{itemize}

\subsubsection{Типы транзакций}

\begin{itemize}
	\item Поддержка микротранзакций (“заплатить за кофе”) благодаря нулевой комиссии.
	\item Отправка XDR.
	\item Отправка Aureus Securities AG.
	\item Анонс на регистрацию ноды.
	\item Анонс об исключении ноды.
	\item Новый genesis block (усечение).
	\item Публикация курса Aureus Securities AG/XDR.
	\item Подача вопроса на голосование нодами.
	\item Голосование нодой.
	\item Эмиссия/обратная эмиссия XDR эмиссионным центром.

\end{itemize}

\subsubsection{Управляющие параметры}

\begin{itemize}
	\item Интервал в блоках, через который запускается процедура усечения блокчейна.
	\item Интервал в блоках, через который повторяется процедура усечения, если предыдущая завершилась неудачно.
	\item Диапазон депозита, позволяющий создавать ноду.
	\item Предельное количество нод.
	\item Обновление управляющих параметров происходит посредством голосования нод.
	
\end{itemize}

\subsubsection{Кошельки}

\begin{itemize}
	\item Адрес кошелька - последовательность символов в кодировке Base58checkerMod2, которая записывается в транзакции, размещаемой в блокчейне.
	\item На кошелек можно получать и принимать и XDR, и Aureus Securities AG.
	\item Типы кошельков:
\begin{itemize}
		\item Легкий:\begin{itemize}
			\item Для расчетов (транзакций) и проверки баланса.
			\item Использует специальный протокол, который позволяет получать необходимые блоки и проверять при этом только дерево Меркла, а не весь блокчейн.
			
		\end{itemize}
	
	\item Стандартный:\begin{itemize}
		\item Хранит весь блокчейн.
		\item Может быть зарегистрирован как нода.
		
	\end{itemize}

\item Multisig:\begin{itemize}
	\item	Виртуальный кошелек, транзакцию с которого система принимает только при нескольких подписях.
\end{itemize}

\item Point wallet:\begin{itemize}
	\item Кошелек разработчика, через который производится точечное управление системой за счет изменения управляющих параметров.
	\item Нужен только на первый год работы блокчейна, затем будет отключён, и это будет прописано в блокчейне.
	
\end{itemize}

\item System wallet:\begin{itemize}
	\item Кошелек для накопления комиссий с удаляемых кошельков при усечении блокчейна. 
	\item С него может быть сформирована исходящая транзакция только для оплаты комиссий нодам,участвовавших в усечении блокчейна.
	
\end{itemize}

	\end{itemize}
	
\end{itemize}

\section{Практическое применение}

\subsection{Свободные международные платежи}

Рынок криптовалюты во многом вырос благодаря спросу на свободные быстрые и недорогие международные платежи. Особенно это касается Китая, где хождение валют сильно ограничено государством. \\

По итогам анализа участников конференции Money 2020 в Сингапуре, ни одна платежная система не позволяет проводить трансграничные сделки размером более 5 000 USD. Единственный инструмент для перевода более 5 000 - 10 000 USD между государствами — SWIFT. Но для осуществления перевода потребуется заполнить множество документов, дождаться проверки документов банком, обсудить перевод с менеджером валютного контроля и затем ждать несколько часов для совершения перевода. Стоимость SWIFT составляет порядка 1\%.\\

Aureus Securities AG позволяет бесплатно переводить любые суммы в любую точку мира 
за несколько секунд без общения с менеджерами банков.
\\

\subsection{Независимое хранение}
Хранить наличные в квартире или доме — опасно. 
В контрактах с банками на хранение имущества в сейфовой ячейке есть пункт о том, что банк не несет ответственности за сохранность содержимого ячейки. В результате из банковских ячеек регулярно пропадают крупные суммы денег. Статистика закрытия банков приведена во “Введении”.
Aureus Securities AG позволяет надежно хранить деньги в децентрализованной сети, с нулевым риском центрального контрагента, без блокировок счетов.

\subsection{Международная кооперативная экономика}
Один из важнейших аспектов обеспечения ценности Aureus Securities AG — реальный оборот товаров и услуг. Авторы Aureus Securities AG видят наибольший потенциал распространения Aureus Securities AG в кооперативной экономике, особенно в развивающихся странах с нестабильной финансовой системой. Именно на этих рынках есть заметный дефицит фиатных денег, а также предрасположенность к бартерным сделкам и иным способам взаимозачетов.

Большинство развитых стран практически остановили экономический рост 
и наибольший вклад в развитие мировой экономики теперь вносят развивающиеся страны. То же самое относится и к бизнесу: крупные корпорации, за исключением некоторых финансовых холдингов, имеют рентабельность ниже 5 \%. А в кризисные годы даже богатые финансовые компании показывают огромные убытки.
\\

При этом \textbf{кооперативы исторически растут против рынка, особенно 
	в кризисное время}. Например:\begin{itemize}
	\item Rabobank показал рост на 42 \% в 2008, а его члены-учредители получили 20 \%-ое увеличение депозитов. За 2008-09 годы уровень членства в кредитных союзах значительно вырос. 
	\item Каждый 3-ий канадец является членом системы кредитных союзов, а доля кредитных союзов на розничных рынках депозитов и жилищной ипотеки выросла с 16 \% до 19 \% в 2010 году [Moody’s investors service global banking report, april 2010].
	\item С первого квартала 2012 кооператив Desjardins занимает 16-ое место из 7500 депозитарных финансовых учреждений в Северной Америке и 2-ое место по показателю капитала первого порядка, который составляет 16.8 \%.
	
\end{itemize}

\textbf{Объем кооперативной экономики огромный}, кооперативы распространены 
и в богатых, и в развивающихся странах:
\begin{itemize}
	\item Кооперативы насчитывают 1 миллиард пайщиков по всему миру.
	\item В Индии потребности 67 \% сельского населения в товарах обеспечиваются кооперативами.
	\item 40 \% африканских домовладельцев входят в кооперативы.
	\item Доход 1500 крупнейших кооперативных организаций в 2010 году составил 
	почти 2 триллиона долларов. 
	\item Development International Desjardins (DID) является лидером в микрофинансах: работает с 8.8 миллионами членов и клиентов по всему миру и обладает ссудным капиталом в 2.5 миллиарда канадских долларов. 
	\item В некоторых африканских странах Desjardins занимает 35 \% микрофинансового рынка.
	\item В Китае кооперативы обеспечивают 91 \% рынка микрокредитов.
	\item Кредитные кооперативы обеспечивают миллиарды долларов доступных денежные переводов от трудовых мигрантов, работающих в развитых странах, их семьям в развивающихся странах, что особенно важно для Латинской Америки и Африки.
	
	
\end{itemize}

\textbf{Кооперативная экономика работает эффективнее}, потому что:\begin{itemize}
	\item Работа кооператива нацелена на заработок для всех пайщиков, 
	а не на раздувание биржевой капитализации.
	\item Все пайщики вовлечены, не надо тратить деньги и время на мотивацию. 
	\item В корпорациях топ-менеджмент зарабатывает в 100 раз больше рядовых сотрудников, а в кооперативах — всего в 10 раз, т.е. издержки на поддержание структуры на порядок ниже.
	\item За счет внутреннего контура экономики и взаимозачетов между участниками кооператива можно сократить издержки на налоги, транзакции и посредников, а также уменьшить потребность в фиатных кредитах. 
	\item В итоге цена товаров и услуг внутри кооперативов получается на 40 \% ниже, чем на внешнем рынке. Это создает стимул для привлечения капитала и людей извне, а также мотивацию для долгосрочного участия в кооперативе.
	
\end{itemize}

\textbf{Инструменты, которые создаются для кооперативов на базе Aureus Securities AG:}

\begin{itemize}
	\item бухгалтерия взаимозачетов,
	\item депозитарий для хранения расписок и балансов,
	\item привлечение финансирования извне, 
	\item подготовка отчетности в налоговые органы,
	\item юридические шаблоны для оформления работы с токенами,
	\item маркетплэйс товаров и услуг с большими скидками.
	
\end{itemize}

\section{Мотивация участников экосистемы}

Пользователи:\begin{itemize}
	\item Получают возможность совершать быстрые бесплатные транзакции 
	или длительно хранить ценность, оставаясь в крипто-пространстве.
	
\end{itemize}

Инвесторы:\begin{itemize}
	\item Заинтересованы в возврате инвестиций.
	\item Возврат может происходить через поддержку системы - любой участник может стать нодой блокчейна и/или эмиссионным центром.
	
\end{itemize}

Эмиссионные центры:\begin{itemize}
	\item Заинтересованы в росте курса Aureus Securities AG, так как это будет увеличивать их капитал и регулярный доход.
	
\end{itemize}

Владельцы нод:\begin{itemize}
	\item Заинтересованы в получении комиссии за подписание блоков в блокчейне.
	\item Диапазон дохода владельца ноды - 8-13 \% годовых в XDR.
	
\end{itemize}

\section{Юридическая оболочка}

\textsl{{\large Первичная продажа }}\\

Первый раунд первичной продажи будет непубличным, закрытым, с KYC и подписанием контрактов между командой разработки и первыми владельцами токенов. Все публичные сделки будут заключаться строго на вторичном рынке и поэтому не потребуют регуляции.\\

\textsl{{\large Повседневное использование }}\\

В случае, если этого не требуют местные законы, либо объемы сделок малы, 
либо регулярность сделок отсутствует, использование Aureus Securities AG можно никак 
не оформлять юридически.
\\

В остальных случаях, особенно при активном проведении сделок в больших объемах, рекомендуется создавать локальные кооперативы или потребительские общества, либо вступать в существующие. 
\\

Главный инструмент в кооперативе — это пай. Паевой взнос — имущественный взнос пайщика в паевой фонд потребительского общества деньгами, ценными бумагами, земельным участком или земельной долей, другим имуществом либо имущественными или иными правами, имеющими денежную оценку. Возврат паевого взноса налогом не облагается независимо от суммы или цены товара, полученного пайщиком.
\\

Любой обмен паев внутри кооператива возможен и не облагается налогами, 
т.е. юридически Aureus Securities AG может быть использован как инструмент для оценки стоимости паев.
\\

Для внешних людей, которые не являются участниками кооператива, 
можно оформить работу с Aureus Securities AG в виде программы лояльности:
\begin{itemize}
	\item Токен — право требования бонусного балла. Это право можно продать юридическому лицу и физическому лицу,  также учесть в бухгалтерии.
	\item В момент обмена токена на товар/услугу владелец токена реализует право требования бонусных баллов, получает баллы, а за них получает товар.
	\item По такой схеме работают бонусные баллы супермаркетов или бонусные мили авиакомпаний.
	
\end{itemize}

\section{Пояснение алгоритма работы консенсуса \textit{sdbft}}

\begin{enumerate}
	
	\item
	Перед началом работы мы имеем пиринговую сеть с узлами, имеющими собственный сетевой адрес и уникальный номер, который знают все участники сети. Например, у нас будет 13 участников сети, пронумеруем все узлы номерами с 1 до 13. Так же мы договоримся, что в консенсус будет входить 5 узлов. 
	\begin{figure}[H]
		\centering
		\def\svgwidth{8cm} % изменить размер
		\input{fig/f1.pdf_tex}
		\label{F1}
		%	\caption{}
	\end{figure}
	Синим цветом будут обозначатся узлы, работающие в блокчейне. Зелёным цветом будут обозначаться узлы, участвующие в консенсусе. Мастер-узел будет помечаться оранжевым цветом. Узлы, находящиеся в нештатном режиме работы будут обозначаться красным цветом.
	
	\item
	Начало работы консенсуса. Пусть все узлы пиринговой сети примут блок 1. В принятом блоке содержится информация, которая позволит функции $f$ (см приложение А) создать случайную последовательность. Пусть эта последовательность будет следующей --- №3,5,7,11,13. Пометим цветом узлы, имеющие №3,5,7,11,13.
	\begin{figure}[H]
		\centering
		\def\svgwidth{8cm} % изменить размер
		\input{fig/f2.pdf_tex}
		\label{F2}
		%	\caption{}
	\end{figure}
	
	\item
	Как показано на рисунке выше узел №3 мы пометили оранжевым цветом, чтобы показать, что он является мастер-узлом. С этого момента узлы №3,5,7,11,13 участвуют в консенсусе.
	
	\item
	Пусть узел №3 получил новую транзакцию от узла №2. Узел №3 проверяет, является ли транзакция корректной, если она признается корректной, то узел №3 пересылает ее узлам №5,7,11,13.
	
	\item
	По завершению времени, отведённого на закрытие блока узел №3 пересылает узлам №5,7,11 и 13 сообщение о закрытии блока.
	\begin{figure}[H]
		\centering
		\def\svgwidth{8cm} % изменить размер
		\input{fig/f3.pdf_tex}
		\label{F3}
		%	\caption{}
	\end{figure}
	
	\item
	Узлы №5,7,11 и 13 пересылают хеш дерева Меркла, принятых ими транзакций, и свои подписи под хешем узлу №3.
	\begin{figure}[H]
		\centering
		\def\svgwidth{8cm} % изменить размер
		\input{fig/f4.pdf_tex}
		\label{F4}
		%	\caption{}
	\end{figure}
	
	\item
	Узел №3 считает подписи, если подписи корректны и их число удовлетворяет решению задачи византийских генералов, их не менее 3, то блок считается сформированным. Узел №3 рассылает анонс нового блока всем узлам сети.
	\begin{figure}[H]
		\centering
		\def\svgwidth{8cm} % изменить размер
		\input{fig/f5.pdf_tex}
		\label{F5}
		%	\caption{}
	\end{figure}
	
	\item
	Узлы принимают блок №2. Возвращаемся на второй шаг алгоритма, пусть теперь функция $f$ (см приложение А) создаст случайную последовательность на основании принятых блоков, пусть будут номера 6,2,3,11,12.
	\begin{figure}[H]
		\centering
		\def\svgwidth{8cm} % изменить размер
		\input{fig/f6.pdf_tex}
		\label{F6}
		%	\caption{}
	\end{figure}
	
	Далее процесс повторяется в соответствии с п.п. 3-8 алгоритма.
\end{enumerate}

\subsubsection{Обработка ошибочных ситуаций алгоритмом \textit{sdbft}}

\paragraph{Мастер узел недоступен}
\begin{enumerate}
	\item
	Повторим п.п. алгоритма 1 и 2.
	
	\item
	Перед началом работы мы имеем пиринговую сеть с узлами, имеющими собственный сетевой адрес и уникальный номер, который знают все участники сети. Например, у нас будет 13 участников сети, пронумеруем все узлы номерами с 1 до 13. Так же мы договоримся, что в консенсус будет входить 5 узлов.
	\begin{figure}[H]
		\centering
		\def\svgwidth{8cm} % изменить размер
		\input{fig/f1.pdf_tex}
		\label{F7}
		%	\caption{}
	\end{figure}
	
	\item
	Начало работы консенсуса. Пусть все узлы пиринговой сети примут блок 1. В принятом блоке содержится информация, которая позволит функции $f$ (см приложение А) создать случайную последовательность. Пусть эта последовательность будет следующей --- №3,5,7,11,13. Узел №3 недоступен. Пометим цветом узлы сети.
	\begin{figure}[H]
		\centering
		\def\svgwidth{8cm} % изменить размер
		\input{fig/f8.pdf_tex}
		\label{F8}
		%	\caption{}
	\end{figure}
	
	
	\item
	Узлы эскорта не получат сообщения о закрытия блока, блокчейн сеть переходит на следующий раунд (см приложение А).
	
	\item
	Возвращаемся на второй шаг алгоритма, пусть теперь функция $f$ (см приложение А) создаст случайную последовательность на основании принятого блока и номера раунда, пусть будут номера 7,1,4,12,13. Сеть блокчейна будет выглядеть следующим образом.
	\begin{figure}[H]
		\centering
		\def\svgwidth{8cm} % изменить размер
		\input{fig/f9.pdf_tex}
		\label{F9}
		%	\caption{}
	\end{figure}
	
	\item
	Далее алгоритм будет исполняться штатным образом в соответствии с п.п. 3-8.
	
\end{enumerate}

\paragraph{Эскорт узел недоступен}
\begin{enumerate}
	\item
	Повторим п.п. алгоритма 1 и 2.
	
	\item
	Перед началом работы мы имеем пиринговую сеть с узлами, имеющими собственный сетевой адрес и уникальный номер, который знают все участники сети. Например, у нас будет 13 участников сети, пронумеруем все узлы номерами с 1 до 13. Так же мы договоримся, что в консенсус будет входить 5 узлов.
	\begin{figure}[H]
		\centering
		\def\svgwidth{8cm} % изменить размер
		\input{fig/f1.pdf_tex}
		\label{F10}
		%	\caption{}
	\end{figure}
	
	\item
	Начало работы консенсуса. Пусть все узлы пиринговой сети примут блок №1. В принятом блоке содержится информация, которая позволит функции $f$ (см. приложение А) создать случайную последовательность. Пусть эта последовательность будет следующей --- 3,5,7,11,13. Узел 13 недоступен. Пометим выбранные узлы цветом.
	\begin{figure}[H]
		\centering
		\def\svgwidth{8cm} % изменить размер
		\input{fig/f11.pdf_tex}
		\label{F11}
		%	\caption{}
	\end{figure}
	
	\item
	Узел эскорта №13 не получит сообщения о закрытия блока и не пошлёт свою подпись для закрытия блока. Если оставшиеся три узла пошлют корректные подписи транзакций формируемого блока, то блок будет сформирован. Узлы, участвующие в консенсусе будут перевыбраны.
	
	\item
	Если оставшиеся три узла пошлют не корректные подписи транзакций формируемого блока, то блок не будет сформирован. Блокчейн перейдёт на следующий раунд. Узлы, участвующие в консенсусе будут перевыбраны.
	
\end{enumerate}

\paragraph{Поступила некорректная транзакция}
\begin{enumerate}
	\item
	Пусть узел 3 получил новую транзакцию от узла №2. Узел №3 проверяет, транзакцию и признает ее некорректной.
	
	\item
	Если узел №3 признал транзакцию некорректной, то он ее отбрасывает, сообщение узлу №2 о некорректной транзакции не пересылается на узлы, входящие в консенсус.
	\begin{figure}[H]
		\centering
		\def\svgwidth{8cm} % изменить размер
		\input{fig/f12.pdf_tex}
		\label{F12}
		%	\caption{}
	\end{figure}
	
\end{enumerate}

\paragraph{Количество блоков в блокчейне разное на разных узлах} \mbox{} \\ 
Разное количество принятых блоков на разных узлах блокчейна может быть разным в случае, например, если сеть была сегментирована и не все узлы успели синхронизироваться. Повторим п.п. 1-5 алгоритма.

\begin{enumerate}
	\item
	Перед началом работы мы имеем пиринговую сеть с узлами, имеющими собственный сетевой адрес и уникальный номер, который знают все участники сети. Например, у нас будет 13 участников сети, пронумеруем все узлы номерами с 1 до 13. Так же мы договоримся, что в консенсус будет входить 5 узлов.	
	\begin{figure}[H]
		\centering
		\def\svgwidth{8cm} % изменить размер
		\input{fig/f1.pdf_tex}
		\label{F13}
		%	\caption{}
	\end{figure}
	
	\item
	Начало работы консенсуса, пусть все узлы пиринговой сети примут блок 1.В принятом блоке содержится информация, которая позволит функции $f$ (см приложение А) создать случайную последовательность. Пусть эта последовательность будет следующей --- 3,5,7,11,13, узлы 7 и 11 имеют отличное число принятых блоков от узлов 3,5,13. Пометим выбранные узлы цветом.
	\begin{figure}[H]
		\centering
		\def\svgwidth{8cm} % изменить размер
		\input{fig/f14.pdf_tex}
		\label{F14}
		%	\caption{}
	\end{figure}
	
	\item
	Как показано на рисунке узел №3 мы пометили оранжевым цветом, чтобы показать, что он является мастер-узлом. С этого момента узлы 3,5,13 участвуют в консенсусе.
	
	\item
	Пусть узел 3 получил новую транзакцию от узла №2. Узел №3 проверяет, является ли транзакция корректной, если она признается корректной, то узел №3 пересылает ее узлам 5,7,11,13. Узлы 7 и 11 отвергают транзакцию.
	\begin{figure}[H]
		\centering
		\def\svgwidth{8cm} % изменить размер
		\input{fig/f15.pdf_tex}
		\label{F15}
		%	\caption{}
	\end{figure}
	
	\item
	По завершению времени на закрытие блока узел №3 пересылает узлам №5,7,11,13 сообщение о закрытии блока, узлы 7 и 11 отвергают сообщение.
	\begin{figure}[H]
		\centering
		\def\svgwidth{8cm} % изменить размер
		\input{fig/f16.pdf_tex}
		\label{F16}
		%	\caption{}
	\end{figure}
	
	\item
	Узлы №5 и 13 пересылают хеш транзакций и свои подписи под хешем узлу №3.
	
	\item
	Узел №3 проверяет подписи узлов эскорта. Так как количество подписей узлов эскорта недостаточно для принятия блока, то блокчейн переходит на следующий раунд.
	\begin{figure}[H]
		\centering
		\def\svgwidth{8cm} % изменить размер
		\input{fig/f17.pdf_tex}
		\label{F17}
		%	\caption{}
	\end{figure}
	
\end{enumerate}

\paragraph{Узел отвергает новый блок блокчейна} \mbox{} \\ 
Узел сети может отвергнуть новый блок блокчейна. Причин, по которым узел отвергает блок может быть несколько, например, на узле в следствии программного или аппаратного сбоя возникла ошибка чтения из базы данных и балансы кошельков изменились. Повторим п.7.

\begin{enumerate}
	\item
	Узел №3 рассылает анонс нового блока всем узлам сети.
	\begin{figure}[H]
		\centering
		\def\svgwidth{8cm} % изменить размер
		\input{fig/f5.pdf_tex}
		\label{F18}
		%	\caption{}
	\end{figure}
	
	\item
	Пусть узел №1 отвергает блок.
	\begin{figure}[H]
		\centering
		\def\svgwidth{8cm} % изменить размер
		\input{fig/f19.pdf_tex}
		\label{F19}
		%	\caption{}
	\end{figure}
	
	\item
	Узел №1 пытается найти в сети блок с отличной от признанного им ошибочным блока хеш-суммой, если узел не может найти удовлетворяющий его блок, то узел начинает процедуру пересинхронизации блокчейна см. п. 3.5.
	
\end{enumerate}

\paragraph{Сеть отвергает новый блок блокчейна} \mbox{} \\ 
При создании нового блока теоретически может произойти сознательная попытка группы узлов навязать собственный, ошибочный, блок. Пусть узлы №3,5,7,11,13 пытаются навязать собственный, неправильный блок сети блокчейна Повторим п.7.

\begin{enumerate}
	\item
	Узел №3 рассылает анонс нового блока всем узлам сети.
	\begin{figure}[H]
		\centering
		\def\svgwidth{8cm} % изменить размер
		\input{fig/f20.pdf_tex}
		\label{F20}
		%	\caption{}
	\end{figure}
	
	\item
	Все узлы сети отвергают новый блок.
	\begin{figure}[H]
		\centering
		\def\svgwidth{8cm} % изменить размер
		\input{fig/f21.pdf_tex}
		\label{F21}
		%	\caption{}
	\end{figure}
	
	\item
	Блокчейн переходит на следующий раунд и далее пока не будет корректно сформирован следующий блок.
	
\end{enumerate}

\paragraph{В сети появилось два блока с идентичными номерами} \mbox{} \\ 
Два блока с идентичными номерами могут возникнуть в сети только, если будет сформировано два консенсуса из узлов с разными раундами, а это возможно если в сети возник глобальный сбой. Например, часть узлов находилась на серверах которые были одновременно перезагружены. В таком случае будет происходить следующее.

\begin{enumerate}
	\item
	Предположим, что сформировалось два набора узлов для создания консенсуса - 3,5,7,11,13 и 8,9,6,1,10. Узел №3 и №8 рассылают анонс нового блока всем узлам сети.
	\begin{figure}[H]
		\centering
		\def\svgwidth{8cm} % изменить размер
		\input{fig/f22.pdf_tex}
		\label{F22}
		%	\caption{}
	\end{figure}
	
	\item
	Узел при принятии нового блока проверяет входит ли раунд создания блока в доверительный интервал раундов или нет. Т.е. насколько сильно раунд нового блока отличается от собственного раунда узла. Если раунд признается узлом корректным, то блок принимается. Если признается не корректным, то блок отвергается. Далее, возможно два пути развития ситуации: 
	\subparagraph{a.} Раунды сформированных блоков находятся в доверительном интервале, в таком случае узлом будет принят блок, пришедший первым. Вероятность попадания в блокчейн блока будет зависеть от того какой блок был принят большинством узлов сети.
	\subparagraph{b.} Раунд одного из сформированных блоков не находится в доверительном интервале у большинства улов сети. Следовательно, большинством узлов будет принят блок с номером раунда из доверительного интервала.
	
\end{enumerate}

\end{document}
